<div class="main-cadastro">
  <p-toast></p-toast>

  <!-- Coluna esquerda -->
  <div class="esquerda-cadastro">
        <header>
            <h2>Cadastre-se</h2>
            <p>Preencha os dados e crie uma conta no nosso sistema.</p>
        </header>

        <form class="cadastro" [formGroup]="cadastroForm" (ngSubmit)="cadastrarUsuario()">
            <!-- DADOS PESSOAIS -->
            <div class="section-title">
                <h3>Dados Pessoais</h3>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nome">Nome Completo *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="nome"
                        pInputText
                        formControlName="nome"
                        placeholder="Digite seu nome completo"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('nome')?.invalid && cadastroForm.get('nome')?.touched">
                        Nome é obrigatório e deve ter pelo menos 2 caracteres
                    </small>
                </div>

                <div class="form-group">
                    <label for="cpf">CPF *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="cpf"
                        pInputText
                        formControlName="cpf"
                        placeholder="000.000.000-00"
                        maxlength="14"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('cpf')?.invalid && cadastroForm.get('cpf')?.touched">
                        <span *ngIf="cadastroForm.get('cpf')?.errors?.['required']">CPF é obrigatório</span>
                        <span *ngIf="cadastroForm.get('cpf')?.errors?.['cpfInvalido']">CPF inválido</span>
                    </small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input
                        class="in-cadastro"
                        type="email"
                        id="email"
                        pInputText
                        formControlName="email"
                        placeholder="Digite seu email"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('email')?.invalid && cadastroForm.get('email')?.touched">
                        <span *ngIf="cadastroForm.get('email')?.errors?.['required']">Email é obrigatório</span>
                        <span *ngIf="cadastroForm.get('email')?.errors?.['email']">Email inválido</span>
                    </small>
                </div>

                <div class="form-group">
                    <label for="emailConfirm">Confirmar Email *</label>
                    <input
                        class="in-cadastro"
                        type="email"
                        id="emailConfirm"
                        pInputText
                        formControlName="emailConfirm"
                        placeholder="Confirme seu email"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('emailConfirm')?.invalid && cadastroForm.get('emailConfirm')?.touched">
                        <span *ngIf="cadastroForm.get('emailConfirm')?.errors?.['required']">Confirmação de email é obrigatória</span>
                    </small>
                    <small class="error-message" *ngIf="cadastroForm.errors?.['emailNaoConfere']">
                        Os emails devem ser iguais
                    </small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="telefone">Telefone</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="telefone"
                        pInputText
                        formControlName="telefone"
                        placeholder="(00) 00000-0000"
                        maxlength="15"
                    />
                </div>

                <div class="form-group">
                    <label for="renda">Renda Mensal (R$)</label>
                    <input
                        class="in-cadastro"
                        type="number"
                        id="renda"
                        pInputText
                        formControlName="renda"
                        placeholder="0,00"
                        step="0.01"
                        min="0"
                    />
                </div>
            </div>

            <!-- ENDEREÇO -->
            <div class="section-title">
                <h3>Endereço</h3>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="cep">CEP *</label>
                    <div class="cep-input-container">
                        <input
                            class="in-cadastro"
                            type="text"
                            id="cep"
                            pInputText
                            formControlName="cep"
                            placeholder="00000-000"
                            maxlength="9"
                            (blur)="consultarCEP()"
                            (input)="formatarCEP($event)"
                            [attr.disabled]="consultandoCEP() ? 'true' : null"
                        />
                        <div class="cep-loading" *ngIf="consultandoCEP()">
                            <i class="pi pi-spin pi-spinner"></i>
                            <span>Consultando...</span>
                        </div>
                    </div>
                    <small class="cep-help" *ngIf="!cepEncontrado && cadastroForm.get('cep')?.value?.length >= 8">
                        CEP não encontrado. Preencha os campos manualmente.
                    </small>
                </div>

                <div class="form-group">
                    <label for="estado">Estado *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="estado"
                        pInputText
                        formControlName="estado"
                        placeholder="SP"
                        maxlength="2"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('estado')?.invalid && cadastroForm.get('estado')?.touched">
                        Estado é obrigatório (2 caracteres)
                    </small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="logradouro">Logradouro *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="logradouro"
                        pInputText
                        formControlName="logradouro"
                        placeholder="Rua, Avenida, etc."
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('logradouro')?.invalid && cadastroForm.get('logradouro')?.touched">
                        Logradouro é obrigatório
                    </small>
                </div>

                <div class="form-group">
                    <label for="numero">Número</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="numero"
                        pInputText
                        formControlName="numero"
                        placeholder="123"
                    />
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="bairro">Bairro *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="bairro"
                        pInputText
                        formControlName="bairro"
                        placeholder="Digite o bairro"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('bairro')?.invalid && cadastroForm.get('bairro')?.touched">
                        Bairro é obrigatório
                    </small>
                </div>

                <div class="form-group">
                    <label for="cidade">Cidade *</label>
                    <input
                        class="in-cadastro"
                        type="text"
                        id="cidade"
                        pInputText
                        formControlName="cidade"
                        placeholder="Digite a cidade"
                    />
                    <small class="error-message" *ngIf="cadastroForm.get('cidade')?.invalid && cadastroForm.get('cidade')?.touched">
                        Cidade é obrigatória
                    </small>
                </div>
            </div>


            <!-- DADOS DE ACESSO -->
            <div class="section-title">
                <h3>Dados de Acesso</h3>
            </div>

            <div class="form-group">
                <label for="usuario">Usuário Login*</label>
                <input
                    class="in-cadastro"
                    type="text"
                    id="usuario"
                    pInputText
                    formControlName="usuario"
                    placeholder="Digite seu usuário"
                />
                <small class="error-message" *ngIf="cadastroForm.get('usuario')?.invalid && cadastroForm.get('usuario')?.touched">
                    <span *ngIf="cadastroForm.get('usuario')?.errors?.['required']">Usuário é obrigatório</span>
                    <span *ngIf="cadastroForm.get('usuario')?.errors?.['minlength']">Usuário deve ter pelo menos 3 caracteres</span>
                </small>
            </div>

            <div class="senhas-grid">
                <div class="form-group">
                    <label for="senha">Senha *</label>
                    <p-password
                        formControlName="senha"
                        [toggleMask]="true"
                        id="senha"
                        placeholder="Digite sua senha">
                    </p-password>
                    <small class="error-message" *ngIf="cadastroForm.get('senha')?.invalid && cadastroForm.get('senha')?.touched">
                        <span *ngIf="cadastroForm.get('senha')?.errors?.['required']">Senha é obrigatória</span>
                        <span *ngIf="cadastroForm.get('senha')?.errors?.['minlength']">Senha deve ter pelo menos 6 caracteres</span>
                    </small>
                </div>

                <div class="form-group">
                    <label for="senhaConfirm">Confirmar Senha *</label>
                    <p-password
                        formControlName="senhaConfirm"
                        [toggleMask]="true"
                        id="senhaConfirm"
                        placeholder="Confirme sua senha">
                    </p-password>
                    <small class="error-message" *ngIf="cadastroForm.get('senhaConfirm')?.invalid && cadastroForm.get('senhaConfirm')?.touched">
                        <span *ngIf="cadastroForm.get('senhaConfirm')?.errors?.['required']">Confirmação de senha é obrigatória</span>
                    </small>
                    <small class="error-message" *ngIf="cadastroForm.errors?.['senhaNaoConfere']">
                        As senhas devem ser iguais
                    </small>
                </div>
            </div>

            <p-button
                class="btn-cadastrar"
                label="Cadastrar"
                type="submit"
                [loading]="loading()">
            </p-button>
        </form>
    </div>

  <div class="direita-cadastro">
    <h3>Bem-vindo(a)!</h3>
    <p>Preencha todos os campos obrigatórios (*) para criar sua conta.</p>
  </div>
</div>
